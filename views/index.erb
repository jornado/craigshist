<!DOCTYPE html>
<html>
<head>
	<title><%= @page_title %>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection">
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=true">
</script>
<script type="text/javascript">

function placeMarker(map, zipCode, lat, lng, count) {
	
	var myLatlng = new google.maps.LatLng(lat, lng);

	var marker = new google.maps.Marker({
		position: myLatlng,
		map: map,
		title: 'Area: '+zipCode
	});
	google.maps.event.addListener(marker, 'click', function() {
		getInfoWindow(zipCode, count, map, marker)
	});

}

function getInfoWindow(zipCode, count, map, marker) {
	
	var contentString = '<div class="alt">Zipcode: '+zipCode+'<br/>Number of listings: '+count+'</div>';
	var infowindow = new google.maps.InfoWindow({
		content: contentString,
		maxWidth: 200
	});
	infowindow.open(map,marker);

}

function initialize() {
	
	var latlng = new google.maps.LatLng(45.532086387683606, -122.67059326171875);
	var myOptions = {
		zoom: 14,
		center: latlng,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

	<% @zips.each do |zip| %>
	placeMarker(map, <%= zip.zip_code %>, <%= zip.lat %>, <%= zip.lng %>, <%= zip.listing.count %>);
	<% end %>
	
}


</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>